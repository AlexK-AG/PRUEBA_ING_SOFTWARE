/*Integrantes:
Jose Ernesto Luquin Gonzalez
Alexis Kaleb Aguilera Correa
Fecha: 02/12/2024
Prueba de in de sw*/
#include <iostream>
#include <limits>
#include <ctime>
#define CLIENTES 50
#define INSTRUCTORES 6
#define PROMOCIONES 4

using namespace std;
int idcont = 1000;

class Contacto {
protected:
    string nombre, correo, direccion, telefono, telefono_emergencia;
    int edad;
public:
    Contacto() = default;
    Contacto(string, string, string, string, string, int);
    void capturar();
    void mostrar();

    string getNombre() const { return nombre; }
    string getTelefono() const { return telefono; }
    int getEdad() const { return edad; }

    void setNombre(const string& _nombre) { nombre = _nombre; }
    void setCorreo(const string& _correo) { correo = _correo; }
    void setDireccion(const string& _direccion) { direccion = _direccion; }
    void setTelefono(const string& _telefono) { telefono = _telefono; }
    void setTelefonoEmergencia(const string& _telefonoEmergencia) { telefono_emergencia = _telefonoEmergencia; }
    void setEdad(int _edad) { edad = _edad; }
};

class Instructor : public Contacto {
private:
    string formacion, categoria, nivel;
    int cupos;
public:
    Instructor(string, int, string, string, string, string, int);
    void mostrarInstructor();

    string getFormacion() const { return formacion; }
    string getCategoria() const { return categoria; }
    string getNivel() const { return nivel; }
    int getCupos() const { return cupos; }

    void setCupos(int _cupos) { cupos = _cupos; }
};

class Cliente : public Contacto {
private:
    string hora_clase;
    int id;
    string categoria, nivel;
    string instructorAsignado;
public:
    Cliente(string, string, string, string, string, int, string, int, string, string);
    void capturarCliente(Instructor[]);
    void mostrarCliente();
    Cliente() : Contacto() {}

    void setHoraClase(const string& _horaClase) { hora_clase = _horaClase; }
    void setCategoria(const string& _categoria) { categoria = _categoria; }
    void setNivel(const string& _nivel) { nivel = _nivel; }
    void setInstructorAsignado(const string& _instructor) { instructorAsignado = _instructor; }

    string getInstructorAsignado() const { return instructorAsignado; }
};
class Promociones{
    private:
    string nombre,vigencia,requisitos;
    public:
        Promociones(string,string,string);
        void mostrarPromo();
};
Promociones::Promociones(string _nombre,string _vigencia, string _requisitos){
    nombre=_nombre;
    vigencia=_vigencia;
    requisitos=_requisitos;
}
Contacto::Contacto(string _nombre, string _correo, string _direccion, string _telefono, string _telefono_emergencia, int _edad) {
    nombre = _nombre;
    correo = _correo;
    direccion = _direccion;
    telefono = _telefono;
    telefono_emergencia = _telefono_emergencia;
    edad = _edad;
}
void Promociones::mostrarPromo(){
    cout<<"Promocion: "<<nombre<<endl;
    cout<<"Vigencia: "<<vigencia<<endl;
    cout<<"Condiciones: "<<requisitos<<endl;
}
void Contacto::capturar() {
    cin.ignore();
    cout << "Ingrese los datos de contacto del cliente:\n";
    cout << "Nombre: ";
    getline(cin, nombre);
    cout << "Correo: ";
    getline(cin, correo);
    cout << "Direccion: ";
    getline(cin, direccion);
    cout << "Telefono: ";
    getline(cin, telefono);
    cout << "Telefono de emergencia: ";
    getline(cin, telefono_emergencia);
    cout << "Edad: ";
    cin >> edad;
}

void Contacto::mostrar() {
    cout << "Nombre: " << nombre << endl;
    cout << "Correo: " << correo << endl;
    cout << "Direccion: " << direccion << endl;
    cout << "Telefono: " << telefono << endl;
    cout << "Telefono de emergencia: " << telefono_emergencia << endl;
    cout << "Edad: " << edad << endl;
}

Instructor::Instructor(string _nombre, int _edad, string _telefono, string _formacion, string _categoria, string _nivel, int _cupos)
    : Contacto(_nombre, "", "", _telefono, "", _edad), formacion(_formacion), categoria(_categoria), nivel(_nivel), cupos(_cupos) {}

void Instructor::mostrarInstructor() {
    cout << "Nombre: " << nombre << endl;
    cout << "Edad: " << getEdad() << endl;
    cout << "Teléfono: " << getTelefono() << endl;
    cout << "Formación: " << getFormacion() << endl;
    cout << "Categoría: " << getCategoria() << endl;
    cout << "Nivel: " << getNivel() << endl;
    cout << "Cupos disponibles: " << getCupos() << endl;
}

Cliente::Cliente(string _nombre, string _correo, string _direccion, string _telefono, string _telefono_emergencia, int _edad, string _hora_clase, int _id, string _categoria, string _nivel)
    : Contacto(_nombre, _correo, _direccion, _telefono, _telefono_emergencia, _edad), hora_clase(_hora_clase), id(_id), categoria(_categoria), nivel(_nivel) {}

void Cliente::capturarCliente(Instructor instructores[]) {
    capturar();
    cout << "Ingrese la hora de clase (mañana o tarde): ";
    cin >> hora_clase;
    cin.ignore();
    cout << "Ingrese el nivel (Principiante, Medio, Avanzado): ";
    getline(cin, nivel);
    cout << "Ingrese la categoria (Bebes, Ninos, Adolescentes, Adultos): ";
    getline(cin, categoria);

    cout << "\nAsigne un instructor:\n";
for (int i = 0; i < INSTRUCTORES; i++) {
    cout << i + 1 << ". " << instructores[i].getNombre()
         << ", Edad: " << instructores[i].getEdad()
         << ", Telefono: " << instructores[i].getTelefono()
         << " - Formacion: " << instructores[i].getFormacion()
         << ", Categoria: " << instructores[i].getCategoria()
         << ", Nivel: " << instructores[i].getNivel()
         << ", Cupos disponibles: " << instructores[i].getCupos() << endl;
}

    int opcion;
    cout<<"Digite su opcion: ";
    cin >> opcion;
    while (opcion < 1 || opcion > INSTRUCTORES || instructores[opcion - 1].getCupos() <= 0) {
        cout << "Opcion invalida o sin cupos. Intente de nuevo: ";
        cin >> opcion;
    }

    Instructor& instructorSeleccionado = instructores[opcion - 1];
    instructorSeleccionado.setCupos(instructorSeleccionado.getCupos() - 1);
    instructorAsignado = instructorSeleccionado.getNombre();

    id = idcont++;
    cout << "Se genero un ID unico para el cliente y se asigno el instructor: " << instructorAsignado << endl;
}

void Cliente::mostrarCliente() {
    mostrar();
    cout << "Hora clase: " << hora_clase << endl;
    cout << "ID: " << id << endl;
    cout << "Nivel: " << nivel << endl;
    cout << "Categoria: " << categoria << endl;
    cout << "Instructor asignado: " << instructorAsignado << endl;
}

void calcularSiguientePago() {
    time_t ahora = time(nullptr); // Obtener la fecha y hora actual
    tm* fechaActual = localtime(&ahora); // Convertir a estructura de fecha

    // Agregar un mes a la fecha actual
    fechaActual->tm_mon += 1;

    // Normalizar la fecha (manejar desbordamiento de días o meses)
    mktime(fechaActual);

    // Mostrar la fecha del siguiente pago
    cout << "su siguiente pago sera el: "
         << fechaActual->tm_mday << "/"
         << (fechaActual->tm_mon + 1) << "/"
         << (fechaActual->tm_year + 1900) << endl;
}

int main() {
    int opcion, i = 0, opc = 0;
    Cliente cliente[CLIENTES];
    Instructor instructores[INSTRUCTORES] = {
        Instructor("Juan Perez", 35, "333456789", "Natacion", "Bebes y niños", "Principiante", 3),
        Instructor("Maria Lopez", 28, "337654321", "Natacion", "Bebes y niños", "Medio", 3),
        Instructor("Carlos Gomez", 40, "337890123", "Natacion", "Adolescentes y adultos", "Avanzado", 7),
        Instructor("Ana Ramirez", 32, "335678901", "Natacion", "Adolescentes y adultos", "Principiante", 7),
        Instructor("Luis Torres", 45, "334567890", "Natacion", "Adoloscentes y adultos", "Medio", 7),
        Instructor("Jose Aguilar", 28, "337890123", "Natacion", "Bebes y niños", "Avanzado", 3)
    };
    Promociones promociones[PROMOCIONES]={
        Promociones("Inscripcion gratis","01 de diciembre de 2024 a 31 de diciembre de 2024","Obten la inscripcion gratis,pagando 2 meses por adelantado" ),
        Promociones("1 mes gratis","01 de diciembre de 2024 a 31 de diciembre de 2024","Solo para ninios con 6 meses o mas de antiguedad en la escuela"),
        Promociones("3 meses por $900","15 de diciembre de 2024 a 15 de enero de 2025","Pagando con tarjeta"),
        Promociones("20% de descuento en membresia anual","01 de enero de 2025 a 15 de enero de 2025","Clientes con un anio minimo de antiguedad")
    };

    do {
        cout << "\n\t\t\t<<<<<<SISTEMA DE REGISTRO INTEGRAL DE LA ESCUELA DE NATACION>>>>>>\n\n";
        cout << "\t\t\t\t\t\tClientes registrados: " << i << endl;
        cout << "\nMenu de opciones:\n";
        cout << "1. Capturar\n";
        cout << "2. Mostrar\n";
        cout << "3. Eliminar\n";
        cout << "4. Buscar\n";
        cout << "5. Modificar\n";
        cout << "6. Ordenar por nombre\n";
        cout << "7. Consultar promociones\n";
        cout << "8. Salir\n";
        cout << "Ingrese una opcion: ";

        cout << "Ingrese una opcion: ";
        cin >> opcion;

        if (cin.fail()) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Opcion inválida. Por favor, ingrese un numero del 1 al 3.\n";
            continue;
        }

        switch (opcion) {
        case 1:
            system("cls");
            cout << "El cliente ya ha relizado el pago de la mensualidad? \n1.Si \n2.No";
            cout << "\nDigite su opcion: ";
            cin >> opc;
            if(opc == 1) {
                cout << "\nPerfecto, ";
                calcularSiguientePago();
                cout << "\nElegiste la opcion capturar datos (maximo 50 clientes)\n";
                if (i < CLIENTES) {
                    cliente[i].capturarCliente(instructores);
                    i++;
                } else {
                    system("cls");
                    cout << "Ya se alcanzó el maximo numero de clientes.\n";
                }
            } else if (opc == 2) {
                system("cls");
                cout << "El cliente debe realizar el pago primero\n";
            } else {
                system("cls");
                cout << "Opcion invalida";
            }
            break;
        case 2:
                system("cls");
                if(i!=0) {
                    cout << "Elegiste la opcion mostrar\n";
                    for (int j = 0; j < i; j++) {
                        cout << "\nCliente " << j + 1 << ":\n";
                        cliente[j].mostrarCliente();
                    }
                } else {
                    system("cls");
                    cout << "No hay clientes por mostrar\n";
                }
            break;
        case 3:{
            system("cls");
            cout << "Elegiste la opcion eliminar\n";
            if(i==0){
                system("cls");
                cout<<"No hay clientes registrados para eliminar\n";
                break;
            }
            string nombreElim;
            cout<<"Ingrese el nombre del cliente que desea eliminar: ";
            cin.ignore();
            getline(cin,nombreElim);
            bool encontrado=false;
            for(int j=0;j<i;j++){
                if(cliente[j].getNombre()==nombreElim){
                    encontrado=true;
                    cout<<"Cliente encontrado, eliminando datos...\n";
                    for(int k=0;k<INSTRUCTORES;k++){
                        if(instructores[k].getNombre()==cliente[j].getInstructorAsignado()){
                            instructores[k].setCupos(instructores[k].getCupos() + 1);
                            cout << "Cupo incrementado para el instructor " << instructores[k].getNombre() << ".\n";
                            break;
                        }
                    }
                    int br=0;
                    for(int k=j;k<i-1;k++){
                        cliente[k]=cliente[k+1];
                    }
                    i--;
                    system("cls");
                    cout<<"Cliente eliminado correctamente!!\n";
                    break;
                }
            }
            if(!encontrado){
                cout<<"Cliente no encontrado\n";
            }
            break;}
        case 4:
            system("cls");
            if (i != 0) {
                cout << "Elegiste la opcion buscar\n";
                string nombreBusqueda;
                cin.ignore();
                cout << "Ingrese el nombre del cliente a buscar: ";
                getline(cin, nombreBusqueda);

                bool encontrado = false;
                for (int j = 0; j < i; j++) {
                    if (cliente[j].getNombre() == nombreBusqueda) {
                        cout << "\nCliente encontrado:\n";
                        cliente[j].mostrarCliente();
                        encontrado = true;
                        break;
                    }
                }

                if (!encontrado) {
                    cout << "\nNo se encontro ningun cliente con ese nombre.\n";
                }
            } else {
                system("cls");
                cout << "No se han capturado clientes aun\n";
            }
            break;
        case 5: {
                system("cls");
                if (i != 0) {
                    cout << "Elegiste la opcion modificar\n";
                    string nombreMod;
                    cin.ignore();
                    cout << "Ingrese el nombre del cliente a modificar: ";
                    getline(cin, nombreMod);

                    bool encontrado = false;
                    for (int j = 0; j < i; j++) {
                        if (cliente[j].getNombre() == nombreMod) {
                            cout << "\nCliente encontrado!!. Datos actuales del cliente:\n";
                            cliente[j].mostrarCliente();
                            encontrado = true;

                            int subopcion;
                            do {
                                cout << "\nSeleccione el dato que desea modificar:\n";
                                cout << "1. Nombre\n";
                                cout << "2. Correo\n";
                                cout << "3. Direccion\n";
                                cout << "4. Telefono\n";
                                cout << "5. Telefono de emergencia\n";
                                cout << "6. Edad\n";
                                cout << "7. Hora de clase\n";
                                cout << "8. Categoria\n";
                                cout << "9. Nivel\n";
                                cout << "10. Cambiar Instructor\n";
                                cout << "11. Salir de modificacion\n";
                                cout << "Digite su opcion: ";
                                cin >> subopcion;

                                switch (subopcion) {
                                    case 1:
                                        cin.ignore();
                                        cout << "Nuevo nombre: ";
                                        {
                                            string nuevoNombre;
                                            getline(cin, nuevoNombre);
                                            cliente[j].setNombre(nuevoNombre);
                                        }
                                        break;
                                    case 2:
                                        cin.ignore();
                                        cout << "Nuevo correo: ";
                                        {
                                            string nuevoCorreo;
                                            getline(cin, nuevoCorreo);
                                            cliente[j].setCorreo(nuevoCorreo);
                                        }
                                        break;
                                    case 3:
                                        cin.ignore();
                                        cout << "Nueva direccion: ";
                                        {
                                            string nuevaDireccion;
                                            getline(cin, nuevaDireccion);
                                            cliente[j].setDireccion(nuevaDireccion);
                                        }
                                        break;
                                    case 4:
                                        cin.ignore();
                                        cout << "Nuevo telefono: ";
                                        {
                                            string nuevoTelefono;
                                            getline(cin, nuevoTelefono);
                                            cliente[j].setTelefono(nuevoTelefono);
                                        }
                                        break;
                                    case 5:
                                        cin.ignore();
                                        cout << "Nuevo telefono de emergencia: ";
                                        {
                                            string nuevoTelefonoEmergencia;
                                            getline(cin, nuevoTelefonoEmergencia);
                                            cliente[j].setTelefonoEmergencia(nuevoTelefonoEmergencia);
                                        }
                                        break;
                                    case 6:
                                        cout << "Nueva edad: ";
                                        {
                                            int nuevaEdad;
                                            cin >> nuevaEdad;
                                            cliente[j].setEdad(nuevaEdad);
                                        }
                                        break;
                                    case 7:
                                        cin.ignore();
                                        cout << "Nueva hora de clase: ";
                                        {
                                            string nuevaHora;
                                            getline(cin, nuevaHora);
                                            cliente[j].setHoraClase(nuevaHora);
                                        }
                                        break;
                                    case 8:
                                        cin.ignore();
                                        cout << "Nueva categoria: ";
                                        {
                                            string nuevaCategoria;
                                            getline(cin, nuevaCategoria);
                                            cliente[j].setCategoria(nuevaCategoria);
                                        }
                                        break;
                                    case 9:
                                        cin.ignore();
                                        cout << "Nuevo nivel: ";
                                        {
                                            string nuevoNivel;
                                            getline(cin, nuevoNivel);
                                            cliente[j].setNivel(nuevoNivel);
                                        }
                                        break;
                                    case 10: {
                                        cout << "\nInstructor actual: " << cliente[j].getInstructorAsignado() << endl;

                                        // Regresar el cupo al instructor actual
                                        for (int k = 0; k < INSTRUCTORES; k++) {
                                            if (instructores[k].getNombre() == cliente[j].getInstructorAsignado()) {
                                                instructores[k].setCupos(instructores[k].getCupos() + 1);
                                                cout << "Cupo regresado al instructor " << instructores[k].getNombre() << ".\n";
                                                break;
                                            }
                                        }

                                        // Mostrar opciones de instructores
                                        cout << "\nSeleccione un nuevo instructor:\n";
                                        for (int k = 0; k < INSTRUCTORES; k++) {
                                            cout << k + 1 << ". " << instructores[k].getNombre()
                                                 << " - Cupos disponibles: " << instructores[k].getCupos() << endl;
                                        }

                                        int nuevaOpcion;
                                        cout << "\nDigte su opcion: ";
                                        cin >> nuevaOpcion;
                                        while (nuevaOpcion < 1 || nuevaOpcion > INSTRUCTORES || instructores[nuevaOpcion - 1].getCupos() <= 0) {
                                            cout << "Opcion invalida o instructor sin cupos. Intente nuevamente: ";
                                            cin >> nuevaOpcion;
                                        }

                                        // Asignar el nuevo instructor
                                        Instructor& nuevoInstructor = instructores[nuevaOpcion - 1];
                                        nuevoInstructor.setCupos(nuevoInstructor.getCupos() - 1);
                                        cliente[j].setInstructorAsignado(nuevoInstructor.getNombre());
                                        cout << "Instructor actualizado a: " << cliente[j].getInstructorAsignado() << endl;
                                        break;
                                    }
                                    case 11:
                                        system("cls");
                                        cout << "Saliendo de modificacion, espere....\n";
                                        break;
                                    default:
                                        cout << "Opcion invalida. Intente nuevamente porfavor.\n";
                                }
                            } while (subopcion != 11);
                            break;
                        }
                    }
                    if (!encontrado) {
                        system("cls");
                        cout << "No se encontro ningun cliente con ese nombre.\n";
                    }
                } else {
                    system("cls");
                    cout << "No hay clientes que modificar\n";
                }
                break;
                }
            break;
        case 6:
            system("cls");
            if(i!=0) {
                cout << "Elegiste la opcion ordenar\n";
                for(int a=0;a<i-1;a++){
                    for(int b=0;b<i-a-1;b++){
                        if(cliente[b].getNombre()>cliente[b+1].getNombre()){
                            Cliente temp=cliente[b];
                            cliente[b]=cliente[b+1];
                            cliente[b+1]=temp;
                        }
                    }
                }
                cout<<"\nClientes ordenados por nombre:\n";
                for(int j=0;j<i;j++){
                    cout<<"\nCliente "<<j+1<<":\n";
                    cliente[j].mostrarCliente();
                }
            } else {
                system("cls");
                cout << "No se han capturado clientes para ordenar\n";
            }
            break;
        case 7:
            cout << "Promociones vigentes o proximas:\n\n";
            for(int i=0;i<PROMOCIONES;i++){
                promociones[i].mostrarPromo();
                cout<<"\n\n";
            }
            break;
        case 8:
            cout << "Elegiste salir del programa, terminando programa...\n";
            break;
        default:
            cout << "Opcion invalida\n";
        }
    } while (opcion != 8);

    return 0;
}
